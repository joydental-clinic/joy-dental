---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { safeFetch, urlFor } from "@/utils/sanity";
import { postsByCategoryQuery } from "@/utils/queries";

const posts = await safeFetch<any[]>(postsByCategoryQuery, { category: "ortho" });

function getCategoryGradient(category: string) {
  if (category === "ortho") return "linear-gradient(135deg, #FCE7F3, #FBCFE8)";
  if (category === "implant") return "linear-gradient(135deg, #DBEAFE, #BFDBFE)";
  return "linear-gradient(135deg, #D1FAE5, #A7F3D0)";
}

function formatDate(dateStr: string) {
  return new Date(dateStr)
    .toLocaleDateString("ko-KR", { year: "numeric", month: "2-digit", day: "2-digit" })
    .replace(/\. /g, ".").replace(/\.$/, "");
}
---

<BaseLayout title="êµì • - ì—°ì„¸ì¡°ì´ì¹˜ê³¼" description="íˆ¬ëª…êµì •, ë°ì´ëª¬êµì •, ìê°€ê²°ì°° ë¸Œë¼ì¼“ ë“± ë‹¤ì–‘í•œ êµì • ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤. ì—°ì„¸ì¡°ì´ì¹˜ê³¼ì˜ êµì • ì§„ë£Œ ì•ˆë‚´ì™€ ì¹¼ëŸ¼ì„ í™•ì¸í•˜ì„¸ìš”.">
  <div class="specialty-page">
    <section class="specialty-hero ortho-hero">
      <div class="specialty-hero-bg" style="background-image: url(/images/ortho-hero.jpg)"></div>
      <div class="specialty-hero-overlay"></div>
      <div class="container">
        <span class="specialty-badge">Orthodontics</span>
        <h1>ì¹˜ì•„êµì •</h1>
        <p>
          íˆ¬ëª…êµì •, ë°ì´ëª¬êµì •, ìê°€ê²°ì°° ë¸Œë¼ì¼“ ë“±<br />
          ë‹¤ì–‘í•œ êµì • ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.
        </p>
      </div>
    </section>

    <section class="section specialty-intro">
      <div class="container">
        <div class="specialty-intro-grid">
          <div class="specialty-intro-card">
            <span class="specialty-intro-icon">
              <svg viewBox="0 0 28 28" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 14c0-5 3-10 8-10s8 5 8 10" />
                <rect x="8" y="12" width="3" height="5" rx="1" />
                <rect x="12.5" y="12" width="3" height="5" rx="1" />
                <rect x="17" y="12" width="3" height="5" rx="1" />
                <path d="M8 17c1 4 3 6 6 6s5-2 6-6" />
              </svg>
            </span>
            <h3>íˆ¬ëª…êµì •</h3>
            <p>ëˆˆì— ë„ì§€ ì•ŠëŠ” íˆ¬ëª… ì¥ì¹˜ë¡œ ì¼ìƒìƒí™œì— ë¶ˆí¸ ì—†ì´ êµì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          </div>
          <div class="specialty-intro-card">
            <span class="specialty-intro-icon">
              <svg viewBox="0 0 28 28" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 20L10 8" />
                <path d="M22 20L18 8" />
                <path d="M10 8h8" />
                <circle cx="14" cy="8" r="2" />
                <path d="M8 14h12" />
                <path d="M12 20l2-6 2 6" />
              </svg>
            </span>
            <h3>ë°ì´ëª¬êµì •</h3>
            <p>ìê°€ê²°ì°° ì‹œìŠ¤í…œìœ¼ë¡œ í†µì¦ì€ ì¤„ì´ê³  ì¹˜ë£Œ ê¸°ê°„ì€ ë‹¨ì¶•í•©ë‹ˆë‹¤.</p>
          </div>
          <div class="specialty-intro-card">
            <span class="specialty-intro-icon">
              <svg viewBox="0 0 28 28" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="14" cy="14" r="11" />
                <circle cx="14" cy="14" r="7" />
                <circle cx="14" cy="14" r="3" />
                <line x1="14" y1="3" x2="14" y2="6" />
                <line x1="14" y1="22" x2="14" y2="25" />
                <line x1="3" y1="14" x2="6" y2="14" />
                <line x1="22" y1="14" x2="25" y2="14" />
              </svg>
            </span>
            <h3>ë§ì¶¤ ì¹˜ë£Œ ê³„íš</h3>
            <p>ë””ì§€í„¸ ë¶„ì„ì„ í†µí•´ í™˜ì ê°œê°œì¸ì— ìµœì í™”ëœ êµì • ê³„íšì„ ì„¤ê³„í•©ë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>
    </section>

    {(posts ?? []).length > 0 && (
      <section class="section specialty-posts">
        <div class="container">
          <h2 class="section-title">êµì • ì¹¼ëŸ¼</h2>
          <p class="section-subtitle">ì¹˜ì•„êµì •ì— ê´€í•œ ì „ë¬¸ì˜ ì¹¼ëŸ¼ê³¼ ì¹˜ë£Œ ì‚¬ë¡€</p>
          <div class="blog-grid">
            {(posts ?? []).map((post) => {
              const thumbUrl = post.thumbnail
                ? urlFor(post.thumbnail).width(400).height(240).fit("crop").url()
                : null;
              return (
                <a href={`/columns/${post.slug.current}`} class="blog-card">
                  <div class="blog-thumb">
                    {thumbUrl ? (
                      <img src={thumbUrl} alt={post.title} class="blog-thumb-img" />
                    ) : (
                      <div class="blog-thumb-bg" style={`background: ${getCategoryGradient(post.category)}`}>
                        ğŸ˜
                      </div>
                    )}
                  </div>
                  <div class="blog-body">
                    <span class={`blog-tag ${post.category}`}>êµì •</span>
                    <h3>{post.title}</h3>
                    <p>{post.excerpt ? post.excerpt.slice(0, 80) : ""}</p>
                    <div class="blog-date">{formatDate(post.date)}</div>
                  </div>
                </a>
              );
            })}
          </div>
        </div>
      </section>
    )}
  </div>
</BaseLayout>
